CORRECT_ANSWER = "-"
CURRENT_SCORE = 0;
HIGH_SCORE = 55;
HAS_BEEN_ANSWERED = false;
NUMBER_OF_ANSWERS = 3;

KIT_PATH = 'kits/nufc/'

// KIT_FILES = ['00-01_away.jpg', '01-02_away.jpg', '01-02_gk.jpg', '01-02_home.jpg', '01-02_third.jpg', '02-03_away.jpg', '02-03_home.jpg', '03-04_away.jpg', '03-04_gk.jpg', '03-04_home.jpg', '04-05_away.jpg', '04-05_gk.jpg', '05-06_away.jpg', '05-06_gk.jpg', '05-06_home.jpg', '06-07_away.jpg', '06-07_gk.jpg', '07-08_away.jpg', '07-08_gk.jpg', '07-08_home.jpg', '08-09_away.jpg', '08-09_home.jpg', '08-09_special.jpg', '09-10_away.jpg', '09-10_home.jpg', '09-10_special.jpg', '10-11_away.jpg', '10-11_home.jpg', '11-12_gk.jpg', '11-12_special.jpg', '12-13_away.jpg', '12-13_gk.jpg', '12-13_gk2.jpg', '12-13_home.jpg', '12-13_third.jpg', '13-14_away.jpg', '13-14_home.jpg', '13-14_third.jpg', '14-15_away.jpg', '14-15_gk.jpg', '14-15_home.jpg', '14-15_third.jpg', '15-16_away.jpg', '15-16_gk.jpg', '15-16_home.jpg', '15-16_special.jpg', '15-16_third.jpg', '16-17_away.jpg', '16-17_home.jpg', '16-17_third.jpg', '17-18_away.jpg', '17-18_gk1.jpg', '17-18_gk2.jpg', '17-18_home.jpg', '17-18_third.jpg', '18-19_away.jpg', '18-19_gk.jpg', '18-19_home.jpg', '18-19_third.jpg', '19-20_away.jpg', '19-20_gk.jpg', '19-20_home.jpg', '19-20_special.jpg', '19-20_third.jpg', '20-21_away.jpg', '20-21_gk.jpg', '20-21_third.jpg', '20_21_home.jpg', '21-22_away.jpg', '21-22_gk.jpg', '21-22_home.jpg', '21-22_third.jpg', '22-23_away.jpg', '22-23_gk.jpg', '22-23_gk2.jpg', '22-23_home.jpg', '22-23_special.jpg', '22-23_third.jpg', '23-24_away.jpg', '23-24_gk.jpg', '23-24_home.jpg', '23-24_third.jpg', '83-84_away.jpg', '83-84_home.jpg', '84-85_away.jpg', '84-85_home.jpg', '85-86_away.jpg', '85-86_home.jpg', '86-87_away.jpg', '86-87_home.jpg', '87-88_away.jpg', '87-88_home.jpg', '90-91_away.jpg', '90-91_home.jpg', '92-93_away.jpg', '92-93_home.jpg', '92-93_third.jpg', '93-94_away.jpg', '93-94_gk1.jpg', '93-94_gk2.jpg', '93-94_home.jpg', '93-94_third.jpg', '94-95_away.jpg', '95-96_third.jpg', '96-97_.jpg', '96-97_away.jpg', '96-97_gk.jpg', '96-97_third.jpg', '97-98_away.jpg', '97-98_home.jpg', '99-00_away.jpg', '99-00_home.jpg', '99-00_special.jpg']
KIT_FILES = ['00-01_ (1).jpg', '00-01_ (2).jpg', '00-01_ (3).jpg', '00-01_ (4).jpg', '01-02_ (1).jpg', '01-02_ (2).jpg', '01-02_ (3).jpg', '01-02_ (4).jpg', '02-03_ (1).jpg', '02-03_ (2).jpg', '02-03_ (3).jpg', '03-04_ (1).jpg', '03-04_ (2).jpg', '03-04_ (3).jpg', '03-04_ (4).jpg', '03-04_ (5).jpg', '04-05_ (1).jpg', '04-05_ (2).jpg', '04-05_ (3).jpg', '04-05_ (4).jpg', '05-06_ (1).jpg', '05-06_ (2).jpg', '05-06_ (3).jpg', '05-06_ (4).jpg', '05-06_ (5).jpg', '06-07_ (1).jpg', '06-07_ (2).jpg', '06-07_ (3).jpg', '06-07_ (4).jpg', '07-08_ (1).jpg', '07-08_ (2).jpg', '07-08_ (3).jpg', '07-08_ (4).jpg', '07-08_ (5).jpg', '08-09_ (1).jpg', '08-09_ (2).jpg', '08-09_ (3).jpg', '08-09_ (4).jpg', '09-10_ (1).jpg', '09-10_ (2).jpg', '09-10_ (3).jpg', '09-10_ (4).jpg', '09-10_ (5).jpg', '10-11_ (1).jpg', '10-11_ (2).jpg', '10-11_ (3).jpg', '10-11_ (4).jpg', '10-11_ (5).jpg', '11-12_ (1).jpg', '11-12_ (2).jpg', '11-12_ (3).jpg', '11-12_ (4).jpg', '11-12_ (5).jpg', '11-12_ (6).jpg', '11-12_ (7).jpg', '12-13_ (1).jpg', '12-13_ (2).jpg', '12-13_ (3).jpg', '12-13_ (4).jpg', '12-13_ (5).jpg', '13-14_ (1).jpg', '13-14_ (2).jpg', '13-14_ (3).jpg', '13-14_ (4).jpg', '13-14_ (5).jpg', '13-14_ (6).jpg', '14-15_ (1).jpg', '14-15_ (2).jpg', '14-15_ (3).jpg', '14-15_ (4).jpg', '14-15_ (5).jpg', '14-15_ (6).jpg', '15-16_ (1).jpg', '15-16_ (2).jpg', '15-16_ (3).jpg', '15-16_ (4).jpg', '15-16_ (5).jpg', '16-17_ (1).jpg', '16-17_ (2).jpg', '16-17_ (3).jpg', '16-17_ (4).jpg', '16-17_ (5).jpg', '17-18_ (1).jpg', '17-18_ (2).jpg', '17-18_ (3).jpg', '17-18_ (4).jpg', '17-18_ (5).jpg', '18-19_ (1).jpg', '18-19_ (2).jpg', '18-19_ (3).jpg', '18-19_ (4).jpg', '18-19_ (5).jpg', '19-20_ (1).jpg', '19-20_ (2).jpg', '19-20_ (3).jpg', '19-20_ (4).jpg', '19-20_ (5).jpg', '19-20_ (6).jpg', '20-21_ (1).jpg', '20-21_ (2).jpg', '20-21_ (3).jpg', '20-21_ (4).jpg', '20-21_ (5).jpg', '20-21_ (6).jpg', '21-22_  (1).jpg', '21-22_  (2).jpg', '21-22_  (3).jpg', '21-22_  (4).jpg', '21-22_  (5).jpg', '21-22_  (6).jpg', '22-23_3.jpg', '22-23_4.jpg', '22-23_5.jpg', '22-23_6.jpg', '22-23_7.jpg', '22-23_8.jpg', '22-23_away.jpg', '22-23_home.jpg', '23-24_3.jpg', '23-24_away.jpg', '23-24_gk.jpg', '23-24_gk2.jpg', '23-24_gk3.jpg', '23-24_home.jpg', '93-94_ (1).jpg', '93-94_ (2).jpg', '93-94_ (3).jpg', '93-94_ (4).jpg', '93-94_ (5).jpg', '94-95_ (1).jpg', '94-95_ (2).jpg', '94-95_ (3).jpg', '94-95_ (4).jpg', '94-95_ (5).jpg', '95-96_ (1).jpg', '95-96_ (2).jpg', '95-96_ (3).jpg', '95-96_ (4).jpg', '96-97_ (1).jpg', '96-97_ (2).jpg', '96-97_ (3).jpg', '96-97_ (4).jpg', '96-97_ (5).jpg', '97-98 (1).jpg', '97-98 (2).jpg', '97-98 (3).jpg', '97-98 (4).jpg', '98-99_ (1).jpg', '98-99_ (2).jpg', '98-99_ (3).jpg', '98-99_ (4).jpg', '99-00_ (1).jpg', '99-00_ (2).jpg', '99-00_ (3).jpg', '99-00_ (4).jpg']

// KIT_YEARS = ["69-70", "82-83", "87-88", "88-89", "90-91", "91-92", "94-95", "95-96", "97-98", "99-00", "00-01",
//              "01-02", "02-03", "03-04", "04-05", "05-06", "07-08", "08-09", "09-10", "10-11", "11-12", "12-13",
//              "13-14", "14-15", "15-16", "16-17", "17-18", "18-19", "19-20", "20-21", "21-22", "22-23", "23-24"]

KIT_YEARS = ['23-24', '12-13', '18-19', '01-02', '09-10', '99-00', '98-99', '19-20', '11-12', '00-01', '21-22',
             '22-23', '96-97', '10-11', '14-15', '02-03', '07-08', '20-21', '94-95', '06-07', '15-16', '16-17',
             '97-98', '03-04', '05-06', '04-05', '93-94', '17-18', '08-09', '13-14', '95-96']

HAS_FIREWORKS_RAN = false;

$(document).ready( function () {
    $("#nextBtn").click(function () {
        resetClasses();
        setUpAnswers();
        randomiseYears();
        HAS_BEEN_ANSWERED = false;
        $("#kit").css('filter', "blur(10px)") 
        $("#gameOverText").hide();
        $("#tryAgainBtn").hide();
        $("#nextBtn").show();
        $("#bonus").text("(+0!)")
    })

    $("#tryAgainBtn").click(function () {
        CURRENT_SCORE = 0;
        $("#score").text("Score : 0")

        resetClasses();
        setUpAnswers();
        randomiseYears();
        HAS_BEEN_ANSWERED = false;
        $("#kit").css('filter', "blur(10px)") 
        $("#gameOverText").hide();
        $("#tryAgainBtn").hide();
        $("#nextBtn").show();
        $("#bonus").text("(+0!)")

    })

    document.getElementById("bonus").addEventListener('transitionend', function(e) {$("#bonus").removeClass("fadeInOut"); });

    setUpAnswers()
    randomiseYears()

    function setUpAnswers() {
        var chosen_file = Math.floor(Math.random() * KIT_FILES.length)
        chosen_file = KIT_PATH + KIT_FILES[chosen_file]
        $("#kit").attr('src', chosen_file) 
        CORRECT_ANSWER = (chosen_file.substring(KIT_PATH.length).split("_")[0]);
        var time = setInterval(function() {
    
           var current_filter = getBlurLevel()
            if (Number(current_filter) <= 0) {
                clearInterval(time);
            }
            current_filter -= 0.1
            new_filter = "blur(" + current_filter + "px)"
    
            $("#kit").css('filter', new_filter) 
    
              }, 100);
    }

});

function getBlurLevel() {
    var current_filter = $("#kit").css('filter') 
    current_filter = current_filter.substring(5)
    current_filter = current_filter.substring(0 , current_filter.length - 3)
    return current_filter
}

function yearGuessed(val) {
    if (!HAS_BEEN_ANSWERED) {
        if (val.textContent == CORRECT_ANSWER){
            CURRENT_SCORE += 10
            var current_filter = getBlurLevel()
            $("#bonus").text("(+" + current_filter + "!)")
            console.log(current_filter);
            CURRENT_SCORE += Number(current_filter)
            CURRENT_SCORE = (Math.round(CURRENT_SCORE * 10)) / 10
            firework()
            $("#kit").css('filter', "blur(0px)") 
            $("#score").text("Score : " + CURRENT_SCORE)
            if ((CURRENT_SCORE > HIGH_SCORE) ) {
                $("#high_score").text("High Score : " + CURRENT_SCORE)
                if (!HAS_FIREWORKS_RAN){ 
                  HAS_FIREWORKS_RAN = true
                  explosionFirework()
                }
            }
            $("#bonus").addClass("fadeInOut") 
        }
        else {
            console.log("WRONG");
            $("#gameOverText").show();
            $("#tryAgainBtn").show();
            $("#nextBtn").hide();
        }
    }
    HAS_BEEN_ANSWERED = true;

    $(".year_guess").each(function() {
        if (this.textContent == CORRECT_ANSWER) {
            $(this).addClass("correct_answer")
        }
        else {
            $(this).addClass("incorrect_answer")
        }
    });
}

function resetClasses() {
    $(".year_guess").each(function() {
        $(this).removeClass("incorrect_answer")
        $(this).removeClass("correct_answer")
    });
}

function randomiseYears() {
    correct_num = Math.floor(Math.random() * NUMBER_OF_ANSWERS) + 1
    correct_box = "#answer_box_" + correct_num
    $(correct_box).text(CORRECT_ANSWER);

    KIT_YEARS_WO_ANS = [...KIT_YEARS]

    const index = KIT_YEARS_WO_ANS.indexOf(CORRECT_ANSWER);
    if (index > -1) { // only splice array when item is found
        KIT_YEARS_WO_ANS.splice(index, 1); // 2nd parameter means remove one item only
    }

    for (let i = 1; i <= NUMBER_OF_ANSWERS; i++) {
        if (i == correct_num) {continue}
        var ind = Math.floor(Math.random() * KIT_YEARS_WO_ANS.length)
        var answer_box_id = "#answer_box_" + i
        $(answer_box_id).text(KIT_YEARS_WO_ANS[ind])
    }
}

function firework() {
    const count = 200,
  defaults = {
    origin: { y: 0.7 },
  };

function fire(particleRatio, opts) {
  confetti(
    Object.assign({}, defaults, opts, {
      particleCount: Math.floor(count * particleRatio),
    })
  );
}

fire(0.25, {
  spread: 26,
  startVelocity: 55,
});

fire(0.2, {
  spread: 60,
});

fire(0.35, {
  spread: 100,
  decay: 0.91,
  scalar: 0.8,
});

fire(0.1, {
  spread: 120,
  startVelocity: 25,
  decay: 0.92,
  scalar: 1.2,
});

fire(0.1, {
  spread: 120,
  startVelocity: 45,
});
}

function explosionFirework() {
    const duration = 15 * 1000,
  animationEnd = Date.now() + duration,
  defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

function randomInRange(min, max) {
  return Math.random() * (max - min) + min;
}

const interval = setInterval(function() {
  const timeLeft = animationEnd - Date.now();

  if (timeLeft <= 0) {
    return clearInterval(interval);
  }

  const particleCount = 50 * (timeLeft / duration);

  // since particles fall down, start a bit higher than random
  confetti(
    Object.assign({}, defaults, {
      particleCount,
      origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
    })
  );
  confetti(
    Object.assign({}, defaults, {
      particleCount,
      origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
    })
  );
}, 250);
}